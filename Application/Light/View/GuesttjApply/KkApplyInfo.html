<extend name="Apply:base" />

<block name="js">
    <script src="__PUBLIC__/assets/layer/layer.js"></script>
    <!--可以打开微信浏览器的控制台-->
    <!--<script src="__PUBLIC__/assets/js/vconsole.min.js"></script>-->
    <script type="text/javascript">
        $(function () {
            var id = getQueryString("aid");
           // 内容过滤选择器 选取含有文本内容text的元素
           $("p:contains('查看客户调价')").children('span :eq(1)').css('style','cursor: pointer');
           $("p:contains('查看客户调价')").children('span :eq(1)').click(function () {
               viewSalesPlan(id);
           })
        })

        // 获取URL参数
        function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }

        function viewSalesPlan(id){
            //需要判断是否是用浏览器打开这个链接的
            if(isWeiXin()==true){
                var title = '查看客户调价';
                var censhu = id+'|'+'title='+title;
                var url = "view_guest_tj_info.php?id="+censhu;
                // "https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx133a00915c785dec&redirect_uri=http%3a%2f%2fwww.fjyuanxin.com%2fyxhb%2findex_index.php&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect"
                var url = "https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx133a00915c785dec&redirect_uri=http%3a%2f%2fwww.fjyuanxin.com%2fsngl%2findex_redirect_parameter.php?url="+url+"&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect";
                window.location.href = url;
            }else{
                var url = 'https://www.fjyuanxin.com/sngl/view_guest_tj_info.php?id='+id+"&type=view";
                var areaArr =  ['750px', '450px'];
                if( window.innerHeight > 600 ) areaArr =  ['550px', '650px'];
                layer.open({
                    type: 2,
                    title: '查看客户调价',
                    fixed: false, //不固定
                    maxmin: true,
                    area: areaArr,
                    // offset: '10px',
                    content: url,
                    zIndex: 99,     //后生成的弹出框会比前一个的z-index的值+1，要设置一个高度，设置的值需要-1
                    end: function(){

                    }
                })
            }
        }

        //判断是否是微信内置的浏览器
        function isWeiXin(){
            var ua = window.navigator.userAgent.toLowerCase();
            if(ua.match(/MicroMessenger/i) == 'micromessenger'){
                return true;
            }else{
                return false;
            }
        }

        //判断是手机还是电脑点击了链接
        function isPC() {
            if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
                return false;
            } else {
                return true;
            }
        }

    </script>>
</block>